<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>NEXUS GOLD | LIVE AI TERMINAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap');
        body { background: #000; color: #f8fafc; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; margin: 0; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .panel-glass { background: rgba(10, 10, 10, 0.98); border: 1px solid rgba(168, 85, 247, 0.25); border-radius: 4px; }
        .bias-bullish { color: #22c55e; border-left: 4px solid #22c55e; background: linear-gradient(90deg, rgba(34, 197, 94, 0.05) 0%, transparent 100%); }
        .bias-bearish { color: #ef4444; border-left: 4px solid #ef4444; background: linear-gradient(90deg, rgba(239, 68, 68, 0.05) 0%, transparent 100%); }
        .bias-neutral { color: #94a3b8; border-left: 4px solid #94a3b8; }
        .pulse-live { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="p-3 h-full flex flex-col gap-3">

    <header class="h-16 panel-glass flex justify-between items-center px-6 border-purple-500/40">
        <div class="flex items-center gap-8">
            <h1 class="font-black italic text-purple-500 tracking-tighter text-xl">NEXUS CORE</h1>
            <div id="bias-indicator" class="bias-neutral px-4 py-1">
                <span class="text-[9px] mono block uppercase text-slate-500">Direccionalidad AI</span>
                <span id="bias-text" class="text-sm font-black italic uppercase">Sincronizando...</span>
            </div>
        </div>
        <div class="text-right flex items-center gap-6">
            <div class="text-right">
                <span class="text-[9px] text-green-500 mono block pulse-live font-bold">● LIVE DATA</span>
                <span id="price-ticker" class="text-xl font-bold mono tracking-tighter">$ --.--</span>
            </div>
        </div>
    </header>

    <div class="flex-1 flex gap-3 overflow-hidden">
        <aside class="w-80 panel-glass p-5 flex flex-col">
            <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-4">Neural News Feed</h3>
            <div id="news-feed" class="flex-1 overflow-y-auto space-y-4 pr-2">
                <p class="text-[10px] text-slate-600 italic">Conectando a Reuters/Bloomberg via FMP...</p>
            </div>
        </aside>

        <main class="flex-1 panel-glass overflow-hidden">
            <div id="tv_chart_main" class="h-full w-full"></div>
        </main>

        <aside class="w-80 panel-glass p-5">
            <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-4 italic">Puntos de Confluencia</h3>
            <div id="ai-context" class="text-[11px] leading-relaxed text-slate-300 italic mb-6 p-2 bg-white/5 rounded">
                Analizando narrativa macro actual...
            </div>
            <ul id="confluence-list" class="space-y-4 text-[11px]">
                </ul>
        </aside>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const FMP_KEY = 'w0Lq926Cu78q0BHVcjQSuzvznUhFPP4J';
        
        const NexusEngine = {
            async init() {
                this.loadChart();
                this.fetchData();
                setInterval(() => this.fetchData(), 120000); // Cada 2 minutos
            },

            loadChart() {
                new TradingView.widget({
                    "autosize": true,
                    "symbol": "OANDA:XAUUSD",
                    "interval": "60",
                    "theme": "dark",
                    "container_id": "tv_chart_main",
                    "backgroundColor": "#000000",
                    "gridColor": "rgba(255, 255, 255, 0.02)"
                });
            },

            async fetchData() {
                try {
                    // 1. Obtener Noticias Reales de Oro y Forex
                    const response = await fetch(`https://financialmodelingprep.com/api/v3/fmp/articles?page=0&size=5&apikey=${FMP_KEY}`);
                    const data = await response.json();
                    
                    // 2. Obtener Precio Real
                    const priceRes = await fetch(`https://financialmodelingprep.com/api/v3/quote/XAUUSD?apikey=${FMP_KEY}`);
                    const priceData = await priceRes.json();
                    
                    if(priceData[0]) {
                        document.getElementById('price-ticker').innerText = `$${priceData[0].price.toFixed(2)}`;
                    }

                    this.processIntelligence(data.content || []);
                } catch (e) {
                    console.error("Error de conexión:", e);
                }
            },

            processIntelligence(news) {
                let bullishScore = 0;
                let keywords = ["gold", "xau", "fed", "inflation", "dollar", "dxy", "yields"];
                
                // Análisis de sentimiento simplificado (IA de dirección)
                news.forEach(item => {
                    const text = item.title.toLowerCase();
                    if(text.includes("weak") || text.includes("cut") || text.includes("fall") || text.includes("dovish")) bullishScore++;
                    if(text.includes("strong") || text.includes("hike") || text.includes("rise") || text.includes("hawkish")) bullishScore--;
                });

                const bias = bullishScore > 0 ? "BULLISH" : (bullishScore < 0 ? "BEARISH" : "NEUTRAL");
                this.renderUI(bias, news);
            },

            renderUI(bias, news) {
                const indicator = document.getElementById('bias-indicator');
                const biasText = document.getElementById('bias-text');
                
                indicator.className = `px-4 py-1 bias-${bias.toLowerCase()}`;
                biasText.innerText = bias;

                // Render News
                document.getElementById('news-feed').innerHTML = news.map(n => `
                    <div class="border-b border-white/5 pb-3">
                        <span class="text-[8px] font-bold text-purple-400">NEWS FEED</span>
                        <p class="text-[10px] font-bold mt-1 uppercase leading-tight">${n.title}</p>
                    </div>
                `).join('');

                // Render Confluence (IA adaptativa)
                const confList = document.getElementById('confluence-list');
                const reasons = bias === "BULLISH" 
                    ? ["Debilidad del Dólar detectada en noticias", "Narrativa Dovish predominante", "Oro actuando como refugio"]
                    : ["Fortaleza del DXY presiona el metal", "Expectativas de tasas altas (Hawkish)", "Liquidación técnica en curso"];

                confList.innerHTML = reasons.map(r => `
                    <li class="flex items-start gap-2 text-slate-300">
                        <i data-lucide="target" size="14" class="text-purple-500"></i> ${r}
                    </li>
                `).join('');

                document.getElementById('ai-context').innerText = `Sesgo ${bias} determinado por análisis de los últimos 5 titulares macro.`;
                
                lucide.createIcons();
            }
        };

        NexusEngine.init();
    </script>
</body>
</html>
